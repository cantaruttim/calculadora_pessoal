{% extends "base.html" %}

{% block content %}
    <hr />
    <br />

    <!-- Container para formulário e resumo lado a lado -->
    <div style="display: flex; gap: 32px; align-items: flex-start; flex-wrap: wrap;">

        <!-- Formulário para adicionar novo gasto -->
        <form action="/gastos/adicionar" method="post" style="flex: 1; min-width: 300px; max-width: 500px; padding: 24px; border: 1px solid #ccc; border-radius: 8px;">
            <h2 style="text-align: center; margin-bottom: 16px;">Adicionar Gasto</h2>
            <div style="margin-bottom: 12px;">
                <label for="dono">Dono:</label>
                <input type="text" id="dono" name="dono" required style="width: 100%; padding: 8px;">
            </div>
            <div style="margin-bottom: 12px;">
                <label for="cartao">Cartão:</label>
                <input type="text" id="cartao" name="cartao" required style="width: 100%; padding: 8px;">
            </div>
            <div style="margin-bottom: 12px;">
                <label for="vigencia">Vigência:</label>
                <input type="text" id="vigencia" name="vigencia" required style="width: 100%; padding: 8px;">
            </div>
            <div style="margin-bottom: 16px;">
                <label for="valor">Valor (R$):</label>
                <input type="text" id="valor" name="valor" required style="width: 100%; padding: 8px;" placeholder="Ex: R$ 150.75">
            </div>
            <button type="submit" style="width: 100%; padding: 10px; background-color: #232321; color: white; border: none; border-radius: 4px; font-size: 1rem;">Adicionar</button>
        </form>

        <!-- Resumo de gastos -->
        <div style="flex: 1; min-width: 250px; padding: 24px; border: 1px solid #ccc; border-radius: 8px; background-color: #f5f5f5;">
            <h2 style="text-align: center; margin-bottom: 16px;">Resumo do Mês</h2>
                {% set total = 0 %}
                {% for g in gastos %}
                    {% set raw_valor = g.valor %}
                    {% set valor_limpo = raw_valor
                        | replace("R$", "")
                        | replace(" ", "")
                        | replace(".", "")
                        | replace(",", ".")
                        | float
                    %}
                    {% set total = total + valor_limpo %}
                {% endfor %}


            <p><strong>Total de Gastos:</strong> R$ {{ "%.2f"|format(total) }}</p>
        </div>

    </div>

    <br /><br />

    <!-- Tabela de gastos -->
    <table border="1" cellpadding="8" cellspacing="0" style="width: 100%; border-collapse: collapse;">
        <thead style="background-color: #232321; color: white;">
            <tr>
                <th>Dono</th>
                <th>Cartão</th>
                <th>Vigência</th>
                <th>Valor (R$)</th>
            </tr>
        </thead>
        <tbody>
            {% for g in gastos %}
            <tr>
                <td>{{ g.dono }}</td>
                <td>{{ g.cartao }}</td>
                <td>{{ g.vigencia }}</td>
                <td>{{ g.valor }}</td> {# Ex: "R$ 150,75" já vem formatado #}
            </tr>
            {% endfor %}
        </tbody>
    </table>
{% endblock %}
